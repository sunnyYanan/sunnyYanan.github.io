---
layout: post
title:  h5打开本地文件－走过的弯路
categories: 前端开发
tag: 文件上传
---

* content
{:toc}

背景
---------
想做个小工具，网页打开一个文件，分析这个文件里的内容，遇到了一些问题。

问题
----------
1、使用h5的文件api，具体参照[这里](https://www.html5rocks.com/zh/tutorials/file/dndfiles/)，但是由于选择一个文本内容很多的文件的时候，页面有卡顿的现象，故以为js处理读取文件的时候是同步读取的，带着这样的一个假设之后，去寻找异步读取文件的方法。找到的比较好的方法是：

- 发送ajax请求
	- 但是有一个问题就是，文件内容太大时，请求数据发送不过去，这时候就想发送文件的路径过去，然后再用java分析文件内容。这时候！坑爹的发现，js无法获取文件的完整路径，因为高版本的浏览器内核将文件路径进行了隐藏，格式都变成了c:/fakepath／x.xx的形式，这样就很不易用了（总不能让所有要使用这个工具的人，都去设置一下浏览器安全模式／或者建一个这样的目录吧）。重新找解决方案，然后在[这篇文章](http://ju.outofmemory.cn/entry/138159)中发现，filereader是异步读取内容的，那为什么当时会感觉到明显的卡顿呢，或许是因为为了验证是否正确的打开了文件，我用
	```
console.log()
	```
	的方式，打印文件的内容，导致控制台输出大文本内容的时候出现了卡顿。


	- 这个过程中，还考虑是不是把文件内容先保存到本地，异步分析后，再删除该文件。


故而，重新修改了实现方式，仍然用filereader的方式，读取文件。哎！之所以这样，就是理解错了`filereader`的读取方式！这时候体现了认真读官方文档的重要性！